<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampaÃ±a FundaciÃ³n - Toca la Campana</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&family=Quicksand:wght@400;500;600;700&display=swap');
        .font-lilita { font-family: 'Lilita One', cursive; }
        .font-quicksand { font-family: 'Quicksand', sans-serif; }
        body { background-color: #0098d9; overflow-x: hidden; }
        
        /* AnimaciÃ³n de la campana */
        @keyframes swing { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(20deg); } 50% { transform: rotate(-18deg); } 75% { transform: rotate(12deg); } }
        .bell-swing { animation: swing 1.2s ease-in-out; transform-origin: top center; }
        
        /* AnimaciÃ³n de las ondas */
        @keyframes wave { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(2.8); opacity: 0; } }
        .wave-ring { 
            border-radius: 50%; border: 4px solid rgba(255, 215, 0, 0.4); 
            position: absolute; animation: wave 2s infinite; pointer-events: none; z-index: 0;
        }

        /* --- NUEVO: ANIMACIÃ“N DE DESTELLOS (CONFETI) --- */
        @keyframes pop-out {
            0% { transform: translate(0, 0) scale(0); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: translate(var(--tw-translate-x), var(--tw-translate-y)) scale(1.2); opacity: 0; }
        }
        .confetti-piece {
            position: absolute;
            top: 50%; left: 50%;
            width: 12px; height: 12px;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        .animate-pop { animation: pop-out 1s ease-out forwards; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from 'firebase/firestore';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';

        // TUS CLAVES
        const firebaseConfig = {
          apiKey: "AIzaSyCO9aonuABDfwjRjmUTKnPGgKRfNVP5VjU",
          authDomain: "campana-fundacion.firebaseapp.com",
          projectId: "campana-fundacion",
          storageBucket: "campana-fundacion.firebasestorage.app",
          messagingSenderId: "641556114718",
          appId: "1:641556114718:web:0de23bcb20481b19a86d0f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const App = () => {
          const [user, setUser] = useState(null);
          const [leads, setLeads] = useState([]);
          const [messages, setMessages] = useState([]);
          const [showLeadModal, setShowLeadModal] = useState(false);
          const [showThanksModal, setShowThanksModal] = useState(false);
          const [isSwinging, setIsSwinging] = useState(false);
          const [formData, setFormData] = useState({ name: '', email: '' });
          const [messageData, setMessageData] = useState('');
          const [loading, setLoading] = useState(false);
          const [errorMessage, setErrorMessage] = useState('');
          
          const audioContextRef = useRef(null);

          // Auth y Datos
          useEffect(() => {
            signInAnonymously(auth).catch(e => console.error(e));
            return onAuthStateChanged(auth, setUser);
          }, []);

          useEffect(() => {
            const unsubLeads = onSnapshot(collection(db, 'leads'), s => setLeads(s.docs.map(d => ({id:d.id, ...d.data()}))));
            const unsubMsgs = onSnapshot(collection(db, 'messages'), s => {
                const data = s.docs.map(d => ({id:d.id, ...d.data()}));
                setMessages(data.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)));
            });
            return () => { unsubLeads(); unsubMsgs(); };
          }, []);

          // Sonido
          const playBellSound = async () => {
            try {
              if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
              const ctx = audioContextRef.current;
              if (ctx.state === 'suspended') await ctx.resume();
              const now = ctx.currentTime;
              [0, 0.2, 0.4, 0.6].forEach((offset, i) => {
                  const t = now + offset;
                  const osc = ctx.createOscillator();
                  const gain = ctx.createGain();
                  osc.connect(gain); gain.connect(ctx.destination);
                  osc.frequency.setValueAtTime(2000 + (i * 50), t); osc.type = 'sine'; 
                  gain.gain.setValueAtTime(0, t);
                  gain.gain.linearRampToValueAtTime(0.6, t + 0.01); 
                  gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3);
                  osc.start(t); osc.stop(t + 0.35);
              });
            } catch (e) { console.log("Audio error"); }
          };

          const handleRing = () => {
            setIsSwinging(true);
            playBellSound();
            setTimeout(() => setIsSwinging(false), 1200);
            setTimeout(() => { setErrorMessage(''); setShowLeadModal(true); }, 1000);
          };

          const submitLead = async (e) => {
            e.preventDefault();
            if (!user) return;
            setLoading(true); setErrorMessage('');
            if (!formData.email.includes('@')) { setErrorMessage("Email incorrecto"); setLoading(false); return; }
            if (leads.some(l => l.email?.toLowerCase() === formData.email.toLowerCase())) {
                setErrorMessage("Â¡Este correo ya registrÃ³ su eco! Gracias ðŸ’œ"); setLoading(false); return;
            }
            try {
              await addDoc(collection(db, 'leads'), {
                name: formData.name, email: formData.email.toLowerCase(), uid: user.uid, timestamp: serverTimestamp(),
              });
              setShowLeadModal(false); setShowThanksModal(true);
            } catch (err) { alert("Error"); } finally { setLoading(false); }
          };

          const submitMessage = async (e) => {
            e.preventDefault();
            if (!messageData.trim()) return;
            setLoading(true);
            try {
              await addDoc(collection(db, 'messages'), {
                name: formData.name || 'AnÃ³nimo', message: messageData, timestamp: serverTimestamp(),
              });
              setMessageData(''); setShowThanksModal(false);
            } catch (err) { alert("Error"); } finally { setLoading(false); }
          };

          const totalEchos = leads.length;
          const workshops = Math.floor(totalEchos / 20);
          const progress = totalEchos % 20;

          // Datos para los destellos (Posiciones aleatorias fijas)
          const particles = [
            {x: '-100px', y: '-80px', color: '#FFD700'}, {x: '100px', y: '-80px', color: '#FF69B4'},
            {x: '-80px', y: '20px', color: '#87CEEB'},   {x: '80px', y: '20px', color: '#FFD700'},
            {x: '-120px', y: '-40px', color: '#FF69B4'}, {x: '120px', y: '-40px', color: '#87CEEB'},
            {x: '0px', y: '-120px', color: '#FFF'},      {x: '0px', y: '-150px', color: '#FFD700'}
          ];

          return (
            <div className="min-h-screen w-full bg-gradient-to-br from-[#0098d9] via-[#116cc5] to-[#0098d9] font-sans text-white overflow-x-hidden p-2 md:p-4 flex flex-col items-center pb-10">
              
              <header className="text-center mb-6 mt-4 w-full max-w-2xl px-4">
                <img src="https://fundacionabrazaunsueno.com/wp-content/uploads/2026/01/logo-faus-blanco.png" alt="Logo" className="h-28 md:h-36 mx-auto mb-4 object-contain drop-shadow-md" />
                <h1 className="font-lilita text-5xl md:text-6xl mb-3 drop-shadow-xl text-[#ffd058]" style={{textShadow: '2px 2px 0px #116cc5'}}>Toca la Campana</h1>
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/10">
                    <p className="text-base md:text-lg font-quicksand font-medium leading-tight mb-2 opacity-95">Haz que la esperanza tambiÃ©n suene para otros niÃ±os que continÃºan su lucha.</p>
                    <p className="text-sm md:text-base font-quicksand font-bold text-[#ffd058] uppercase tracking-wide">Cada 20 campanadas, un niÃ±o recibe un kit de arteterapia ðŸŽ¨</p>
                </div>
              </header>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-3xl mb-6">
                <div className="bg-white rounded-2xl p-4 text-center shadow-lg"><div className="font-lilita text-5xl md:text-6xl text-[#0098d9]">{workshops}</div><div className="text-[#116cc5] text-base font-bold uppercase">Talleres Logrados</div></div>
                <div className="bg-white rounded-2xl p-4 text-center shadow-lg"><div className="font-lilita text-5xl md:text-6xl text-[#0098d9]">{totalEchos}</div><div className="text-[#116cc5] text-base font-bold uppercase">Ecos Totales</div></div>
              </div>

              <div className="w-full max-w-2xl mb-8 px-2">
                <div className="bg-[#116cc5]/30 backdrop-blur-md rounded-full p-1.5 border border-white/20">
                  <div className="bg-white/20 h-10 rounded-full overflow-hidden relative">
                    <div className="h-full bg-gradient-to-r from-[#ffd058] to-[#ffb800]" style={{ width: `${(progress / 20) * 100}%`, transition: 'width 1s ease' }}></div>
                    <div className="absolute inset-0 flex items-center justify-center font-bold text-white drop-shadow-md text-base md:text-lg">Faltan {20 - progress} ecos para el prÃ³ximo taller</div>
                  </div>
                </div>
              </div>

              {/* --- CAMPANA CON DESTELLOS --- */}
              <div className="relative mb-6 flex items-center justify-center h-48 md:h-60 pointer-events-none">
                <div className="wave-ring w-48 h-48 md:w-64 md:h-64" style={{ animationDelay: '0s' }}></div>
                <div className="wave-ring w-48 h-48 md:w-64 md:h-64" style={{ animationDelay: '0.6s' }}></div>
                
                {/* PartÃ­culas de Confetti */}
                {isSwinging && particles.map((p, i) => (
                    <div key={i} className="confetti-piece animate-pop" 
                         style={{ 
                             '--tw-translate-x': p.x, 
                             '--tw-translate-y': p.y, 
                             backgroundColor: p.color,
                             animationDelay: `${i * 0.05}s`
                         }}>
                    </div>
                ))}

                <div onClick={handleRing} className={`cursor-pointer z-10 relative transition-all hover:scale-110 active:scale-95 pointer-events-auto ${isSwinging ? 'bell-swing' : ''}`}>
                   <svg width="200" height="200" viewBox="0 0 200 200" className="drop-shadow-2xl md:w-[250px] md:h-[250px]">
                    <defs><linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style={{stopColor:'#ffd700'}} /><stop offset="100%" style={{stopColor:'#d4af37'}} /></linearGradient></defs>
                    <g transform="translate(100, 50)">
                      <rect x="-5" y="-20" width="10" height="25" rx="3" fill="#d4af37" />
                      <path d="M -50 80 Q -50 20 0 0 Q 50 20 50 80 Z" fill="url(#goldGrad)" />
                      <ellipse cx="0" cy="80" rx="55" ry="15" fill="#d4af37" />
                      <ellipse cx="0" cy="80" rx="52" ry="13" fill="url(#goldGrad)" />
                      <circle cx="0" cy="75" r="8" fill="#654321" />
                    </g>
                  </svg>
                </div>
              </div>

              <button onClick={handleRing} className="relative z-50 bg-[#ffd058] text-[#116cc5] font-lilita text-2xl md:text-4xl px-10 py-4 rounded-full shadow-xl hover:bg-[#ffb800] hover:scale-105 active:scale-95 transition-all mb-10 border-b-8 border-[#d4af37]">Â¡HACER SONAR!</button>

              <div className="w-full max-w-2xl px-4 mb-10 animate-in fade-in slide-in-from-bottom duration-1000">
                <div className="bg-white/95 backdrop-blur-md rounded-2xl p-6 text-center shadow-lg border-2 border-white/20">
                    <img src="https://fundacionabrazaunsueno.com/wp-content/uploads/2026/01/ARTETERAPIA-FAUS-.png" alt="NiÃ±os" className="w-full h-56 md:h-64 object-cover rounded-xl mb-6 shadow-md" />
                    <p className="text-[#116cc5] font-quicksand text-base md:text-lg leading-relaxed mb-4">
                        <strong className="font-bold text-xl block mb-2">Tocar la campana significa haber ganado una batalla contra el cÃ¡ncer.</strong>
                        En oncologÃ­a pediÃ¡trica, es el gesto con el que muchos niÃ±os celebran el final de una etapa dura del tratamiento.
                    </p>
                    <p className="text-[#0098d9] font-quicksand text-base md:text-lg font-semibold italic">"Y cuando suena, deja una certeza en el aire: la esperanza es realâ€¦ y puede volver a sonar para otros niÃ±os."</p>
                </div>
              </div>

              <div className="w-full max-w-4xl mb-10 px-2">
                <div className="flex items-center justify-center gap-2 mb-4"><h2 className="font-lilita text-3xl md:text-4xl text-white drop-shadow-md">Mural de Esperanza</h2><span className="text-3xl">ðŸ’Œ</span></div>
                <div className="bg-white/10 backdrop-blur-sm rounded-[20px] p-4 border border-white/20 min-h-[300px] max-h-[500px] overflow-y-auto custom-scrollbar">
                  {messages.length === 0 ? <div className="text-center text-white/70 font-quicksand text-lg italic py-8">AÃºn no hay mensajes.</div> : 
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                      {messages.map((m, idx) => (
                        <div key={idx} className={`bg-white p-5 rounded-lg shadow-md transform ${idx % 2 === 0 ? 'rotate-1' : '-rotate-1'} hover:rotate-0 transition-all hover:z-10`}>
                            <div className="flex justify-between mb-2 border-b border-gray-100 pb-1"><span className="font-bold text-[#116cc5] uppercase text-xs tracking-wider truncate mr-2">{m.name}</span><span className="text-red-400 text-xs">ðŸ“Œ</span></div>
                            <p className="text-gray-600 font-quicksand italic text-xs leading-relaxed line-clamp-6">"{m.message}"</p>
                        </div>
                      ))}
                    </div>
                  }
                </div>
              </div>

              <div className="w-full max-w-xl px-2"><div className="bg-white rounded-2xl p-5 text-center shadow-xl border-b-4 border-[#ffd058] transform hover:scale-105 transition-all"><p className="text-[#116cc5] text-xl font-bold flex flex-col md:flex-row items-center justify-center gap-2"><span>ðŸŽ¨</span><span>Cada eco financia alegrÃ­a y terapia para los niÃ±os</span><span>ðŸ’œ</span></p></div></div>

              {/* --- NUEVO DISEÃ‘O DE MODAL "MI ECO" --- */}
              {showLeadModal && (
                <div className="fixed inset-0 bg-[#001f3f]/90 flex items-center justify-center z-50 p-4 backdrop-blur-sm" style={{zIndex: 100}}>
                  <div className="bg-white rounded-[30px] w-full max-w-md shadow-2xl relative overflow-hidden animate-in zoom-in duration-300">
                    
                    {/* ENCABEZADO AZUL */}
                    <div className="bg-[#0098d9] p-8 text-center relative">
                        <button onClick={() => setShowLeadModal(false)} className="absolute top-4 right-4 text-white/70 hover:text-white text-3xl font-bold">&times;</button>
                        <div className="text-6xl mb-2 filter drop-shadow-md">ðŸ’›</div>
                        <h2 className="text-white font-lilita text-4xl mb-1 drop-shadow-md">Â¡Tu eco ya resuena!</h2>
                        <p className="text-white/90 text-lg font-quicksand">Confirma tus datos para que sume oficialmente</p>
                    </div>

                    {/* CUERPO BLANCO */}
                    <div className="p-8 bg-white">
                        {errorMessage && <div className="bg-red-100 text-red-600 p-3 rounded-xl mb-4 text-sm font-bold text-center">{errorMessage}</div>}
                        
                        <form onSubmit={submitLead} className="space-y-5">
                            <div>
                                <label className="block text-gray-700 font-bold mb-2 ml-1">Tu nombre</label>
                                <input type="text" placeholder="Â¿CÃ³mo te llamas?" className="w-full bg-gray-50 border-2 border-gray-200 rounded-xl px-5 py-3 outline-none focus:border-[#0098d9] focus:bg-white text-gray-700 text-lg transition-all" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} required />
                            </div>
                            <div>
                                <label className="block text-gray-700 font-bold mb-2 ml-1">Tu email</label>
                                <input type="email" placeholder="correo@ejemplo.com" className="w-full bg-gray-50 border-2 border-gray-200 rounded-xl px-5 py-3 outline-none focus:border-[#0098d9] focus:bg-white text-gray-700 text-lg transition-all" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} required />
                            </div>
                            
                            {/* BOTÃ“N AMARILLO GRANDE */}
                            <button type="submit" disabled={loading} className="w-full bg-[#ffd058] text-[#116cc5] font-lilita text-2xl py-4 rounded-xl hover:bg-[#ffb800] transition-transform active:scale-95 shadow-xl uppercase tracking-wide border-b-4 border-[#d4af37]">
                                {loading ? '...' : 'Â¡CONFIRMAR MI ECO!'}
                            </button>
                        </form>
                    </div>
                  </div>
                </div>
              )}

              {showThanksModal && (
                <div className="fixed inset-0 bg-[#001f3f]/90 flex items-center justify-center z-50 p-4 backdrop-blur-sm" style={{zIndex: 100}}>
                  <div className="bg-white rounded-[20px] p-6 max-w-sm w-full text-center shadow-2xl animate-in zoom-in duration-300">
                    <div className="text-5xl mb-2">ðŸ’›</div>
                    <h2 className="text-[#116cc5] font-lilita text-3xl mb-1">Â¡Gracias!</h2>
                    <p className="text-gray-500 mb-6 text-base">Deja un mensaje en el mural</p>
                    <form onSubmit={submitMessage}>
                      <textarea className="w-full bg-[#116cc5] border-none rounded-lg p-4 text-white placeholder-white/70 mb-4 focus:ring-2 focus:ring-[#ffd058] outline-none h-32 resize-none text-base" placeholder="Escribe algo bonito..." value={messageData} onChange={e => setMessageData(e.target.value)}></textarea>
                      <div className="flex gap-2">
                        <button type="button" onClick={() => setShowThanksModal(false)} className="flex-1 py-3 text-gray-400 font-bold text-base">Saltar</button>
                        <button type="submit" disabled={loading} className="flex-1 bg-[#ffd058] text-[#116cc5] font-bold py-3 rounded-lg hover:bg-[#ffb800] shadow-md text-base">Publicar</button>
                      </div>
                    </form>
                  </div>
                </div>
              )}

            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
