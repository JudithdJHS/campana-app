<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampaÃ±a FundaciÃ³n - Toca la Campana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/app-check": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app-check.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&family=Quicksand:wght@400;500;600;700&display=swap');
        .font-lilita { font-family: 'Lilita One', cursive; }
        .font-quicksand { font-family: 'Quicksand', sans-serif; }
        body { background-color: #f8fafc; overflow-x: hidden; }
        @keyframes swing { 0% { transform: rotate(0deg); } 20% { transform: rotate(15deg); } 40% { transform: rotate(-10deg); } 60% { transform: rotate(5deg); } 80% { transform: rotate(-3deg); } 100% { transform: rotate(0deg); } }
        .bell-swing { animation: swing 1.0s ease-in-out; transform-origin: top center; }
    </style>
</head>
<body class="bg-gradient-to-b from-white to-blue-50">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy, limit } from 'firebase/firestore';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { initializeAppCheck, ReCaptchaV3Provider } from 'firebase/app-check';

        const firebaseConfig = {
          apiKey: "AIzaSyCO9aonuABDfwjRjmUTKnPGgKRfNVP5VjU",
          authDomain: "campana-fundacion.firebaseapp.com",
          projectId: "campana-fundacion",
          storageBucket: "campana-fundacion.firebasestorage.app",
          messagingSenderId: "641556114718",
          appId: "1:641556114718:web:0de23bcb20481b19a86d0f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Seguridad Restaurada
        initializeAppCheck(app, {
          provider: new ReCaptchaV3Provider('6Lc-Q1MsAAAAAO1Qpg2P-oi3knv3XNxg4P3X40ZX'),
          isTokenAutoRefreshEnabled: true
        });

        const App = () => {
          const [user, setUser] = useState(null);
          const [leads, setLeads] = useState([]);
          const [messages, setMessages] = useState([]);
          const [showLeadModal, setShowLeadModal] = useState(false);
          const [showThanksModal, setShowThanksModal] = useState(false);
          const [welcomeMessage, setWelcomeMessage] = useState(false);
          const [showGoalModal, setShowGoalModal] = useState(false);
          const [isSwinging, setIsSwinging] = useState(false);
          const [formData, setFormData] = useState({ name: '', email: '', privacy: false });
          const [messageData, setMessageData] = useState('');

          useEffect(() => {
            signInAnonymously(auth).catch(e => console.error(e));
            return onAuthStateChanged(auth, setUser);
          }, []);

          useEffect(() => {
            const unsubLeads = onSnapshot(collection(db, 'leads'), s => setLeads(s.docs.map(d => ({id:d.id, ...d.data()}))));
            const q = query(collection(db, 'messages'), orderBy('timestamp', 'desc'), limit(30));
            const unsubMsgs = onSnapshot(q, s => setMessages(s.docs.map(d => ({id:d.id, ...d.data()}))));
            return () => { unsubLeads(); unsubMsgs(); };
          }, []);

          // LÃ³gica de SofÃ­a Activa
          useEffect(() => {
            if (leads.length > 0 && leads.length % 20 === 0) {
              setShowGoalModal(true);
            }
          }, [leads.length]);

          const handleRing = () => {
            setIsSwinging(true);
            setTimeout(() => { setIsSwinging(false); setShowLeadModal(true); }, 1200);
          };

          const submitLead = async (e) => {
            e.preventDefault();
            try {
              await addDoc(collection(db, 'leads'), { name: formData.name, email: formData.email.toLowerCase(), timestamp: serverTimestamp() });
              setShowLeadModal(false); setWelcomeMessage(true);
            } catch (err) { alert("Error"); }
          };

          const submitMessage = async (e) => {
            e.preventDefault();
            try {
              await addDoc(collection(db, 'messages'), { name: formData.name || 'Amigo', message: messageData, timestamp: serverTimestamp() });
              setMessageData(''); setShowThanksModal(false); alert("Â¡Eco de esperanza enviado! ğŸ’Œ");
            } catch (err) { alert("Error"); }
          };

          const postItColors = ['bg-[#ffe66d]', 'bg-[#ffc6ff]', 'bg-[#9bf6ff]', 'bg-[#ffd6a5]', 'bg-[#caffbf]'];

          return (
            <div className="min-h-screen w-full font-sans text-gray-800 p-2 flex flex-col items-center pb-10">
              <header className="text-center w-full max-w-4xl mt-4 mb-8">
                <img src="https://fundacionabrazaunsueno.com/wp-content/uploads/2026/01/toca-la-campana-movil.jpg" className="w-full max-w-md mx-auto rounded-2xl shadow-xl" />
                <h1 className="font-lilita text-5xl text-[#0098d9] mt-6 tracking-tight uppercase">Toca la Campana</h1>
                <p className="text-xs font-bold text-[#0098d9] uppercase tracking-widest mt-2">by FUNDACIÃ“N ABRAZA UN SUEÃ‘O</p>
              </header>

              <div className="w-full max-w-3xl px-4 mb-12 text-center">
                  <h2 className="font-lilita text-3xl text-[#0098d9] mb-4 uppercase">Â¿QuÃ© significa tocar la campana? ğŸ””</h2>
                  <div className="bg-blue-50 border-l-4 border-[#ffd058] p-6 rounded-r-2xl shadow-sm text-left">
                      <p className="font-quicksand text-lg text-gray-700 italic">"Es el sonido de la victoria: el gesto con el que un niÃ±o celebra haber ganado una batalla contra el cÃ¡ncer."</p>
                  </div>
              </div>

              <div onClick={handleRing} className={`cursor-pointer mb-12 transition-transform hover:scale-105 active:scale-95 ${isSwinging ? 'bell-swing' : ''}`}>
                <svg width="180" height="180" viewBox="0 0 300 300">
                  <g transform="translate(150, 50)">
                    <circle cx="0" cy="0" r="15" fill="#eab308" />
                    <path d="M -70 180 Q -90 60 -30 20 L 30 20 Q 90 60 70 180 Q 120 190 120 210 L -120 210 Q -120 190 -70 180 Z" fill="#facc15" />
                  </g>
                </svg>
              </div>

              <div className="grid grid-cols-2 gap-4 w-full max-w-md mb-12">
                <div className="bg-[#0098d9] rounded-3xl p-6 text-center text-white shadow-lg">
                  <div className="font-lilita text-5xl">{Math.floor(leads.length / 20)}</div>
                  <p className="font-bold uppercase text-xs tracking-tighter opacity-80">Talleres Logrados</p>
                </div>
                <div className="bg-[#ffd058] rounded-3xl p-6 text-center text-[#001f3f] shadow-lg">
                  <div className="font-lilita text-5xl">{leads.length}</div>
                  <p className="font-bold uppercase text-xs tracking-tighter opacity-80">Ecos Totales</p>
                </div>
              </div>

              <div className="w-full max-w-5xl px-4">
                <h2 className="font-lilita text-3xl text-center text-[#0098d9] mb-8 uppercase tracking-widest">Mural de Esperanza ğŸ’Œ</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                  {messages.map((m, i) => (
                    <div key={i} className={`${postItColors[i % 5]} p-6 rounded-lg shadow-lg transform rotate-${i%2===0?1:'-1'}`}>
                      <p className="font-quicksand text-gray-800 leading-relaxed font-medium">"{m.message}"</p>
                      <p className="text-right font-lilita text-[#001f3f] mt-4">- {m.name}</p>
                    </div>
                  ))}
                </div>
              </div>

              {/* MODALES DE INTERACCIÃ“N */}
              {showLeadModal && (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[150] p-4 backdrop-blur-md">
                  <form onSubmit={submitLead} className="bg-white rounded-[32px] w-full max-w-sm overflow-hidden animate-in zoom-in shadow-2xl">
                    <div className="bg-[#0098d9] p-6 text-center text-white">
                      <h2 className="font-lilita text-3xl uppercase">Â¡Deja tu eco!</h2>
                    </div>
                    <div className="p-6 space-y-4">
                      <input type="text" placeholder="Tu nombre" className="w-full border-2 border-gray-100 p-4 rounded-xl focus:border-[#ffd058] outline-none" onChange={e => setFormData({...formData, name: e.target.value})} required />
                      <input type="email" placeholder="Tu email" className="w-full border-2 border-gray-100 p-4 rounded-xl focus:border-[#ffd058] outline-none" onChange={e => setFormData({...formData, email: e.target.value})} required />
                      <button type="submit" className="w-full bg-[#ffd058] text-[#001f3f] font-lilita text-2xl py-4 rounded-xl shadow-lg uppercase tracking-wider">Â¡REGISTRAR ECO! ğŸ””</button>
                    </div>
                  </form>
                </div>
              )}

              {welcomeMessage && (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[160] p-4 backdrop-blur-md">
                  <div className="bg-white rounded-[32px] p-8 text-center max-w-sm shadow-2xl animate-in zoom-in">
                    <h2 className="font-lilita text-3xl text-[#0098d9] mb-4 uppercase">Â¡GRACIAS POR TU ECO!</h2>
                    <p className="font-quicksand text-lg text-gray-600 mb-8 leading-relaxed">Tu registro se ha sumado a esta gran orquesta de esperanza.</p>
                    <button onClick={() => { setWelcomeMessage(false); setShowThanksModal(true); }} className="w-full bg-[#0098d9] text-white py-4 rounded-xl font-lilita text-2xl shadow-lg uppercase">Siguiente</button>
                  </div>
                </div>
              )}

              {showThanksModal && (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[150] p-4 backdrop-blur-md">
                  <form onSubmit={submitMessage} className="bg-white rounded-[32px] w-full max-w-sm overflow-hidden shadow-2xl animate-in zoom-in">
                     <div className="bg-[#0098d9] p-6 text-center text-white"><h2 className="font-lilita text-2xl uppercase tracking-tighter">Â¿Dejas un mensaje para los niÃ±os?</h2></div>
                     <div className="p-6">
                       <textarea className="w-full border-2 border-gray-100 p-4 rounded-xl h-40 resize-none outline-none focus:border-[#ffd058]" placeholder="Escribe aquÃ­ tu mensaje de fuerza..." onChange={e => setMessageData(e.target.value)}></textarea>
                       <div className="flex gap-3 mt-4">
                         <button type="button" onClick={() => setShowThanksModal(false)} className="flex-1 py-4 bg-gray-50 text-gray-400 font-bold rounded-xl uppercase">Omitir</button>
                         <button type="submit" className="flex-2 bg-[#0098d9] text-white py-4 px-6 rounded-xl font-bold uppercase shadow-lg">Enviar Eco ğŸš€</button>
                       </div>
                     </div>
                  </form>
                </div>
              )}

              {/* MODAL ESPECIAL CADA 20 CAMPANADAS */}
              {showGoalModal && (
                <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-[200] p-4 backdrop-blur-lg">
                  <div className="bg-white rounded-[40px] w-full max-w-md shadow-2xl overflow-hidden animate-in zoom-in duration-500">
                    <div className="bg-[#ffd058] p-10 text-center text-[#001f3f]">
                      <div className="text-7xl mb-4 animate-bounce">ğŸ””</div>
                      <h2 className="font-lilita text-3xl leading-tight uppercase">Â¡EL CIELO CELEBRA!</h2>
                      <p className="font-bold opacity-80 mt-2 uppercase text-sm tracking-widest tracking-widest">Meta de {leads.length} campanadas lograda</p>
                    </div>
                    <div className="p-10 text-center">
                      <p className="font-quicksand text-gray-700 text-xl mb-8 leading-relaxed">
                        Â¡Lo has logrado! TÃº y otras 19 personas acaban de completar una nueva meta. 
                        <br /><br />
                        Hoy financiamos el <strong>Taller de Arteterapia nÂº {leads.length / 20}</strong> para SofÃ­a y sus compaÃ±eros. ğŸ¨âœ¨
                      </p>
                      <button onClick={() => setShowGoalModal(false)} className="w-full bg-[#0098d9] text-white font-lilita text-3xl py-6 rounded-3xl shadow-xl uppercase">Â¡AMÃ‰N! ğŸ™</button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
