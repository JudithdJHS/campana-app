<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campa√±a Fundaci√≥n - Toca la Campana</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- SCRIPT DE DONACI√ìN AFRUS -->
    <script type="module" src="https://afrus-frontend-assets.s3.eu-central-1.amazonaws.com/Widget-prod/webcomponents.es.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lilita+One&family=Quicksand:wght@400;500;600;700&display=swap');
        .font-lilita { font-family: 'Lilita One', cursive; }
        .font-quicksand { font-family: 'Quicksand', sans-serif; }
        body { background-color: #f8fafc; overflow-x: hidden; }
        
        /* Animaciones */
        @keyframes swing { 
            0% { transform: rotate(0deg); } 
            20% { transform: rotate(15deg); } 
            40% { transform: rotate(-10deg); } 
            60% { transform: rotate(5deg); } 
            80% { transform: rotate(-3deg); } 
            100% { transform: rotate(0deg); } 
        }
        .bell-swing { animation: swing 1.0s ease-in-out; transform-origin: top center; }
        
        /* ONDAS VISIBLES */
        @keyframes ripple { 
            0% { transform: scale(0.8); opacity: 1; border-width: 6px; } 
            100% { transform: scale(2.4); opacity: 0; border-width: 0px; } 
        }
        .ripple-ring { 
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%; 
            border: 4px solid #facc15; 
            animation: ripple 2s infinite; 
            pointer-events: none; 
            z-index: 0;
            opacity: 0;
        }

        /* Destellos */
        @keyframes pop-particle {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.2); opacity: 0; }
        }
        .particle {
            position: absolute;
            top: 50%; left: 50%;
            pointer-events: none;
            animation: pop-particle 1s ease-out forwards;
            font-size: 24px;
            z-index: 20;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-white to-blue-50">

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from 'firebase/firestore';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';

        // TUS CLAVES REALES
        const firebaseConfig = {
          apiKey: "AIzaSyCO9aonuABDfwjRjmUTKnPGgKRfNVP5VjU",
          authDomain: "campana-fundacion.firebaseapp.com",
          projectId: "campana-fundacion",
          storageBucket: "campana-fundacion.firebasestorage.app",
          messagingSenderId: "641556114718",
          appId: "1:641556114718:web:0de23bcb20481b19a86d0f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const App = () => {
          const [user, setUser] = useState(null);
          const [leads, setLeads] = useState([]);
          const [messages, setMessages] = useState([]);
          const [showLeadModal, setShowLeadModal] = useState(false);
          const [showThanksModal, setShowThanksModal] = useState(false);
          const [isSwinging, setIsSwinging] = useState(false);
          const [formData, setFormData] = useState({ name: '', email: '', privacy: false });
          const [messageData, setMessageData] = useState('');
          const [loading, setLoading] = useState(false);
          const [errorMessage, setErrorMessage] = useState('');
          
          const audioContextRef = useRef(null);

          // Auth
          useEffect(() => {
            signInAnonymously(auth).catch(e => console.error(e));
            return onAuthStateChanged(auth, setUser);
          }, []);

          // Datos
          useEffect(() => {
            const unsubLeads = onSnapshot(collection(db, 'leads'), s => setLeads(s.docs.map(d => ({id:d.id, ...d.data()}))));
            const unsubMsgs = onSnapshot(collection(db, 'messages'), s => {
                const data = s.docs.map(d => ({id:d.id, ...d.data()}));
                setMessages(data.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)));
            });
            return () => { unsubLeads(); unsubMsgs(); };
          }, []);

          // Sonido
          const playBellSound = async () => {
            try {
              if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
              const ctx = audioContextRef.current;
              if (ctx.state === 'suspended') await ctx.resume();
              const now = ctx.currentTime;
              [0, 0.2, 0.4, 0.6].forEach((offset, i) => {
                  const t = now + offset;
                  const osc = ctx.createOscillator();
                  const gain = ctx.createGain();
                  osc.connect(gain); gain.connect(ctx.destination);
                  osc.frequency.setValueAtTime(2000 + (i * 50), t); osc.type = 'sine'; 
                  gain.gain.setValueAtTime(0, t);
                  gain.gain.linearRampToValueAtTime(0.6, t + 0.01); 
                  gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3);
                  osc.start(t); osc.stop(t + 0.35);
              });
            } catch (e) { console.log("Audio error"); }
          };

          const handleRing = () => {
            setIsSwinging(true);
            playBellSound();
            setTimeout(() => setIsSwinging(false), 1200);
            setTimeout(() => { setErrorMessage(''); setShowLeadModal(true); }, 1500);
          };

          const submitLead = async (e) => {
            e.preventDefault();
            if (!user) return;
            setLoading(true); setErrorMessage('');
            
            if (!formData.email.includes('@')) { setErrorMessage("Email incorrecto"); setLoading(false); return; }
            if (!formData.privacy) { setErrorMessage("Debes aceptar la pol√≠tica de privacidad"); setLoading(false); return; }
            
            if (leads.some(l => l.email?.toLowerCase() === formData.email.toLowerCase())) {
                setErrorMessage("¬°Este correo ya registr√≥ su eco! Gracias üíú"); setLoading(false); return;
            }
            try {
              await addDoc(collection(db, 'leads'), {
                name: formData.name, email: formData.email.toLowerCase(), uid: user.uid, timestamp: serverTimestamp(),
              });
              setShowLeadModal(false); setShowThanksModal(true);
            } catch (err) { alert("Error"); } finally { setLoading(false); }
          };

          const submitMessage = async (e) => {
            e.preventDefault();
            if (!messageData.trim()) return;
            setLoading(true);
            try {
              await addDoc(collection(db, 'messages'), {
                name: formData.name || 'An√≥nimo', message: messageData, timestamp: serverTimestamp(),
              });
              setMessageData(''); setShowThanksModal(false);
            } catch (err) { alert("Error"); } finally { setLoading(false); }
          };

          const totalEchos = leads.length;
          const workshops = Math.floor(totalEchos / 20);
          const progress = totalEchos % 20;

          const postItColors = [
            'bg-[#ffe66d]', 'bg-[#ffc6ff]', 'bg-[#9bf6ff]', 'bg-[#ffd6a5]', 'bg-[#caffbf]'
          ];

          const particles = [
            {tx: '-80px', ty: '-80px', char: '‚ù§Ô∏è', d: '0s'}, {tx: '80px', ty: '-90px', char: 'üíõ', d: '0.1s'},
            {tx: '-60px', ty: '10px', char: 'üíô', d: '0.2s'}, {tx: '70px', ty: '30px', char: '‚ù§Ô∏è', d: '0.1s'},
            {tx: '0px', ty: '-120px', char: '‚ú®', d: '0.3s'}, {tx: '-90px', ty: '-40px', char: 'üîµ', d: '0s'},
            {tx: '90px', ty: '-30px', char: 'üü°', d: '0.2s'}, {tx: '0px', ty: '-150px', char: 'üíô', d: '0.4s'}
          ];

          return (
            <div className="min-h-screen w-full font-sans text-gray-800 overflow-x-hidden p-2 flex flex-col items-center pb-10">
              
              {/* --- HEADER --- */}
              <header className="text-center w-full max-w-4xl px-2 mt-4 mb-2 animate-in fade-in slide-in-from-top duration-700">
                <img src="https://fundacionabrazaunsueno.com/wp-content/uploads/2026/01/toca-la-campana-movil.jpg" 
                     alt="Campa√±a Toca la Campana" 
                     className="w-full max-w-md mx-auto mb-3 rounded-xl shadow-sm hover:scale-105 transition-transform duration-300 object-contain" />
                
                <p className="text-xs md:text-sm font-bold text-[#0098d9] uppercase tracking-widest mb-4">
                    by FUNDACI√ìN ABRAZA UN SUE√ëO
                </p>
              </header>

              {/* --- TEXTO EXPLICATIVO --- */}
              <div className="w-full max-w-3xl px-4 mb-8 text-center">
                  <h2 className="font-lilita text-4xl md:text-5xl text-[#001f3f] mb-4">
                      üîî Toca la campana, cambia una vida
                  </h2>
                  <p className="font-quicksand text-lg md:text-xl text-[#116cc5] font-bold leading-tight mb-3">
                      Un gesto de victoria que llega al hospital
                  </p>
                  <p className="font-quicksand text-gray-600 text-base md:text-lg leading-relaxed mb-8">
                      En oncolog√≠a infantil, tocar la campana celebra el fin de una etapa. Hoy, t√∫ puedes hacer que ese sonido se convierta en alivio real para quienes siguen luchando.
                  </p>

                  {/* --- CAJA DE PASOS (AUMENTADA) --- */}
                  <div className="bg-white rounded-2xl p-8 shadow-lg border border-blue-100 text-left">
                      <h3 className="font-lilita text-3xl text-[#0098d9] mb-6 text-center">¬øC√≥mo funciona tu impacto?</h3>
                      
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                          {/* Paso 1 */}
                          <div className="flex flex-col items-center text-center">
                              <div className="w-16 h-16 bg-[#ffd058] rounded-full flex items-center justify-center font-lilita text-3xl text-[#116cc5] mb-4 shadow-sm">1</div>
                              <h4 className="font-bold text-[#001f3f] text-xl mb-2">Haz sonar la campana</h4>
                              <p className="text-base text-gray-600 leading-relaxed">√önete simb√≥licamente a la alegr√≠a de vencer el c√°ncer.</p>
                          </div>
                          
                          {/* Paso 2 */}
                          <div className="flex flex-col items-center text-center">
                              <div className="w-16 h-16 bg-[#ffd058] rounded-full flex items-center justify-center font-lilita text-3xl text-[#116cc5] mb-4 shadow-sm">2</div>
                              <h4 className="font-bold text-[#001f3f] text-xl mb-2">Deja un mensaje</h4>
                              <p className="text-base text-gray-600 leading-relaxed">Tu voz aparecer√° en el <strong>Mural de la Esperanza</strong> para animar a otros ni√±os.</p>
                          </div>

                          {/* Paso 3 */}
                          <div className="flex flex-col items-center text-center">
                              <div className="w-16 h-16 bg-[#ffd058] rounded-full flex items-center justify-center font-lilita text-3xl text-[#116cc5] mb-4 shadow-sm">3</div>
                              <h4 className="font-bold text-[#001f3f] text-xl mb-2">Crea esperanza</h4>
                              <p className="text-base text-gray-600 leading-relaxed">Por cada <strong>20 campanadas</strong>, financiamos un <strong>Taller de Arteterapia</strong> en el hospital.</p>
                          </div>
                      </div>
                  </div>
              </div>

              {/* --- CAMPANA --- */}
              <div className="relative mt-12 mb-4 flex items-center justify-center h-64 md:h-80 pointer-events-none">
                <div className="ripple-ring w-64 h-64 md:w-80 md:h-80" style={{ animationDelay: '0s' }}></div>
                <div className="ripple-ring w-64 h-64 md:w-80 md:h-80" style={{ animationDelay: '1s' }}></div>
                
                {isSwinging && particles.map((p, i) => (
                    <div key={i} className="particle" style={{ '--tx': p.tx, '--ty': p.ty, animationDelay: p.d }}>{p.char}</div>
                ))}

                <div onClick={handleRing} className={`cursor-pointer z-10 relative transition-all hover:scale-110 active:scale-95 pointer-events-auto ${isSwinging ? 'bell-swing' : ''}`}>
                   
                   {/* SVG CAMPANA CANVA */}
                   <svg width="250" height="250" viewBox="0 0 300 300" className="drop-shadow-2xl md:w-[320px] md:h-[320px]">
                    <g transform="translate(150, 50)">
                        <circle cx="0" cy="0" r="15" fill="#eab308" />
                        <path d="M -70 180 Q -90 60 -30 20 L 30 20 Q 90 60 70 180 Q 120 190 120 210 L -120 210 Q -120 190 -70 180 Z" fill="#facc15" />
                        <path d="M -68 150 Q 0 160 68 150 L 75 170 Q 0 180 -75 170 Z" fill="#eab308" opacity="0.3" />
                        <ellipse cx="0" cy="210" rx="120" ry="20" fill="#ca8a04" />
                        <path d="M -120 210 Q 0 240 120 210 Q 0 190 -120 210" fill="#facc15" />
                        <line x1="0" y1="50" x2="0" y2="220" stroke="#ca8a04" strokeWidth="8" />
                        <circle cx="0" cy="240" r="25" fill="#facc15" />
                    </g>
                  </svg>

                </div>
              </div>

              {/* --- MICRO-REFUERZO Y BOT√ìN --- */}
              <div className="flex flex-col items-center mt-6">
                  {/* Micro-refuerzo */}
                  <p className="text-base md:text-lg text-[#0098d9] font-bold mb-3 animate-pulse">
                      ‚ú® Tu mensaje se ver√° en el Mural de la Esperanza
                  </p>

                  <button onClick={handleRing} className="relative z-50 bg-[#0098d9] text-white font-lilita text-3xl md:text-4xl px-14 py-6 rounded-full shadow-xl hover:bg-[#007bb5] hover:scale-105 active:scale-95 transition-all mb-8 border-b-8 border-[#00699b] flex items-center gap-3">
                    ¬°HACER SONAR! <span>üîî</span>
                  </button>
              </div>

              {/* --- TARJETA META (TEXTO ACTUALIZADO) --- */}
              <div className="bg-white rounded-2xl p-6 shadow-md w-full max-w-2xl text-center mb-8 border border-gray-100">
                  <p className="text-gray-700 font-quicksand text-xl font-medium leading-relaxed">
                      Cada <span className="font-lilita text-[#ffd058] text-3xl">20 campanadas</span>, un ni√±o que lucha contra el c√°ncer recibe un taller de arteterapia en el hospital, un espacio de acompa√±amiento emocional en medio de su tratamiento. üé®üíô
                  </p>
              </div>

              {/* --- CONTADORES --- */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl mb-8">
                <div className="bg-[#0098d9] rounded-2xl p-6 text-center shadow-lg text-white">
                  <div className="font-lilita text-6xl mb-1">{workshops}</div>
                  <div className="font-bold text-sm uppercase tracking-wide opacity-90">Talleres Logrados</div>
                </div>
                <div className="bg-[#ffd058] rounded-2xl p-6 text-center shadow-lg text-gray-800">
                  <div className="font-lilita text-6xl mb-1">{totalEchos}</div>
                  <div className="font-bold text-sm uppercase tracking-wide opacity-80">Ecos Totales</div>
                </div>
              </div>

              {/* --- BARRA PROGRESO --- */}
              <div className="w-full max-w-2xl mb-12 px-2">
                <div className="bg-[#0098d9] rounded-full p-2 shadow-inner">
                  <div className="bg-white/20 h-14 rounded-full overflow-hidden relative">
                    <div className="h-full bg-[#ffd058]" style={{ width: `${(progress / 20) * 100}%`, transition: 'width 1s ease' }}></div>
                    <div className="absolute inset-0 flex items-center justify-center font-bold text-white drop-shadow-md text-lg md:text-2xl">
                      ¬°Solo faltan {20 - progress} ecos! üé®‚ú®
                    </div>
                  </div>
                </div>
              </div>

              {/* --- MURAL COLORIDO --- */}
              <div className="w-full max-w-4xl mb-10 px-2">
                <div className="flex items-center justify-center gap-2 mb-4"><h2 className="font-lilita text-3xl md:text-4xl text-[#0098d9] drop-shadow-sm">Mural de Esperanza</h2><span className="text-3xl">üíå</span></div>
                
                <div className="bg-white/50 backdrop-blur-sm rounded-[20px] p-4 min-h-[300px] max-h-[500px] overflow-y-auto custom-scrollbar">
                  {messages.length === 0 ? <div className="text-center text-gray-400 font-quicksand text-lg italic py-8">A√∫n no hay mensajes.</div> : 
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                      {messages.map((m, idx) => {
                        const bgColor = postItColors[idx % postItColors.length];
                        const rotate = idx % 2 === 0 ? 'rotate-1' : '-rotate-1';
                        return (
                          <div key={idx} className={`${bgColor} p-6 rounded-lg shadow-md transform ${rotate} hover:rotate-0 transition-all hover:scale-105 text-gray-800`}>
                              <div className="flex justify-between mb-3 border-b border-black/10 pb-2">
                                <span className="font-bold text-black/70 uppercase text-sm tracking-wider truncate mr-2">{m.name}</span>
                                <span className="text-lg">üìå</span>
                              </div>
                              <p className="font-quicksand font-medium text-lg leading-relaxed line-clamp-6">"{m.message}"</p>
                          </div>
                        );
                      })}
                    </div>
                  }
                </div>
              </div>

              {/* --- PIE DE P√ÅGINA (AZUL #2957a4) --- */}
              <div className="w-full max-w-xl px-2 mb-16">
                  <div className="rounded-2xl p-5 text-center shadow-xl transform hover:scale-105 transition-all" 
                       style={{ backgroundColor: '#2957a4', borderBottom: '6px solid #ffd058' }}>
                    <p className="text-white text-xl font-bold flex flex-col md:flex-row items-center justify-center gap-2">
                        <span>üé®</span>
                        <span>Cada eco financia alegr√≠a y terapia para los ni√±os</span>
                        <span>üíú</span>
                    </p>
                  </div>
              </div>

              {/* --- SECCI√ìN DE DONACI√ìN --- */}
              <div className="w-full max-w-4xl px-4 pb-20 text-center">
                  <h3 className="font-lilita text-3xl md:text-4xl text-[#080808] mb-4">Algunas personas deciden hacer sonar la campana un poco m√°s fuerte</h3>
                  <p className="font-quicksand text-xl text-[#116cc5] font-bold mb-8">Haz que su eco llegue a√∫n m√°s lejos</p>
                  
                  <div className="bg-white rounded-3xl p-6 shadow-2xl border border-gray-100">
                      <afrus-form form-id="cb73bc53-3aa1-4069-971e-f9edddf26191" preview="false"></afrus-form>
                  </div>
              </div>

              {/* MODALES */}
              {showLeadModal && (
                <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm" style={{zIndex: 100}}>
                  <div className="bg-white rounded-[24px] w-full max-w-sm shadow-2xl relative overflow-hidden animate-in zoom-in duration-300">
                    <div className="bg-[#0098d9] p-6 text-center relative">
                        <button onClick={() => setShowLeadModal(false)} className="absolute top-3 right-3 text-white/70 hover:text-white text-2xl font-bold">&times;</button>
                        <div className="text-5xl mb-2 filter drop-shadow-md">üíõ</div>
                        <h2 className="text-white font-lilita text-3xl mb-1">¬°Tu eco ya resuena!</h2>
                        <p className="text-blue-100 text-sm font-quicksand">Confirma tus datos para que sume oficialmente</p>
                    </div>
                    <div className="p-6 bg-white space-y-4">
                        {errorMessage && <div className="bg-red-50 text-red-500 p-2 rounded text-xs text-center font-bold">{errorMessage}</div>}
                        <form onSubmit={submitLead} className="space-y-4">
                            <div><label className="block text-gray-700 font-bold mb-1 text-sm ml-1">Tu nombre</label><input type="text" placeholder="¬øC√≥mo te llamas?" className="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 outline-none focus:border-[#0098d9] focus:ring-2 focus:ring-blue-100 text-gray-700 text-base transition-all" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} required /></div>
                            <div><label className="block text-gray-700 font-bold mb-1 text-sm ml-1">Tu email</label><input type="email" placeholder="correo@ejemplo.com" className="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 outline-none focus:border-[#0098d9] focus:ring-2 focus:ring-blue-100 text-gray-700 text-base transition-all" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} required /></div>
                            <div className="flex items-start gap-2 mt-2"><input type="checkbox" id="privacy" className="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked={formData.privacy} onChange={e => setFormData({...formData, privacy: e.target.checked})} /><label htmlFor="privacy" className="text-xs text-gray-500 leading-tight">Acepto la pol√≠tica de privacidad y el tratamiento de mis datos para fines de la fundaci√≥n.</label></div>
                            <button type="submit" disabled={loading} className="w-full bg-[#ffd058] text-gray-800 font-lilita text-xl py-3 rounded-xl hover:bg-[#ffc107] transition-all shadow-md uppercase tracking-wide mt-2">{loading ? '...' : '¬°CONFIRMAR MI ECO!'}</button>
                        </form>
                    </div>
                  </div>
                </div>
              )}

              {showThanksModal && (
                <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm" style={{zIndex: 100}}>
                  <div className="bg-white rounded-[24px] w-full max-w-sm shadow-2xl overflow-hidden animate-in zoom-in duration-300">
                     <div className="bg-[#0098d9] p-6 text-center">
                        <div className="text-5xl mb-2">üéâ</div>
                        <h2 className="text-white font-lilita text-3xl">¬°Gracias!</h2>
                        <p className="text-blue-100 text-sm">Deja un mensaje en el mural</p>
                     </div>
                     <div className="p-6">
                        <form onSubmit={submitMessage}>
                          <textarea className="w-full bg-blue-50 border border-blue-100 rounded-lg p-3 text-gray-700 focus:ring-2 focus:ring-[#ffd058] outline-none h-24 resize-none text-sm" placeholder="Escribe algo bonito..." value={messageData} onChange={e => setMessageData(e.target.value)}></textarea>
                          <div className="flex gap-2 mt-4">
                            <button type="button" onClick={() => setShowThanksModal(false)} className="flex-1 py-2 text-gray-400 font-bold text-sm">Saltar</button>
                            <button type="submit" disabled={loading} className="flex-1 bg-[#ffd058] text-gray-800 font-bold py-2 rounded-lg hover:bg-[#ffc107] shadow-md text-sm">Publicar</button>
                          </div>
                        </form>
                     </div>
                  </div>
                </div>
              )}

            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
